## Магия в действии: дрон-неудачник против коварного Ветра
Давайте посмотрим, как эта магия работает, на конкретном подопытном.

Герой нашего романа — маленький дрон, который умеет летать только влево-вправо. Его великая миссия — висеть в точке ноль и не отсвечивать. Обозначим его позицию как $x$, скорость — $v$, а ускорение — $a$. Управлять мы будем, как завещал классик теории управления Понтрягин, — задавая ему боковое ускорение $u$.

**Сцена 1: Идеальный мир в лаборатории**
В тишине и безветрии лаборатории всё просто. Физика для дрона описывается одной фразой: «куда сказали, туда и ускоряюсь». Для тех, кто любит погорячее, вот формула: $a = u$. То есть реальное ускорение дрона $a$ в точности равно нашему управляющему ускорению $u$.
Чтобы заставить его висеть на месте, мы даём ему простейший «мозг» (ПД-регулятор), девиз которого: «Унесло вправо? Толкай влево!».
$$ u = -k_p x - k_d v $$
Тут $x$ — это позиция дрона, а $v$ — его скорость. $k_p$ и $k_d$ — это просто ручки «силы пинка», которые мы настраиваем. 

Чем сильнее дрона отнесло в сторону и чем больше его скорость, тем сильнее он тянемся в противоположную сторону. То есть если дрона унесло на расстояние до соседнего магазина, возвращаться он будет с ускорением межгалактической ракеты. Ну, а при малых отклонениях едва качнется в сторону цели. 

После пары колебаний, как студент после бессонной ночи, дрон находит равновесие и замирает в нуле. Успех!


**Сцена 2: Внезапный выход на улицу**
И тут на сцену выходит злодей — коварный боковой Ветер. Он создает своё собственное ускорение $w$, о силе которого мы понятия не имеем. Уравнение мира становится сложнее:
$$ a = u + w $$
То есть общее ускорение дрона теперь — результат нашего управления и пинка от Ветра. 
Наш старый контроллер с его наивным «толкай-обратно» впадает в панику. Он честно пытается вернуть дрон в ноль, но Ветер дует постоянно. В итоге дрон не висит в центре, а позорно застревает где-то сбоку, находя хрупкий баланс между командой «домой!» и настойчивым «уходи!» от Ветра. Миссия провалена.

**Сцена 3: Апгрейд мозга, или Адаптация 50-го уровня (года)**
Что делать? Прокачать нашему дрону мозги! Научим его не слепо бороться с последствиями, а понимать и предсказывать действия врага.

1.  **Заводим «дневник наблюдений»**: Дрон создаёт у себя в памяти переменную $\hat{w}$. Это его личная догадка, его гипотеза о том, какой силы этот наглый Ветер. Изначально полагаем $\hat{w}=0$.
2.  **Новый план действий**: Теперь его логика хитрее: «Я буду делать всё, как раньше, НО заранее дам упреждающего пинка в сторону, противоположную той, откуда, как я *думаю*, дует Ветер».
    $$ u = -k_p x - k_d v - \hat{w} $$
    Этот $\hat{w}$ в конце — и есть наш контрудар.
3.  **Закон адаптации (самое-самое интересное)**: Как дрону понять, что его гипотеза о ветре — чушь? Он постоянно сверяется со своим «детектором неудачи» — специальной величиной $s = v + x$. Если этот детектор не равен нулю, значит, что-то идёт не так, и пора пересматривать свои взгляды на жизнь (и на ветер). А если он равен нулю, значит его позиция $x$ и его скорость $v$ равны нулю, а мы этого и добивались. Есть тут еще небольшая вероятность, что позиция и скорость противоположны друг другу и равны по силе как гопота на стрелке, но это несильно нас беспокоит. 

    Правило обновления гениально в своей простоте. Вместо того чтобы менять свою догадку непрерывно, наш цифровой дрон делает это шажками, например, каждые 20 миллисекунд. На каждом шаге он смотрит на свой «детектор неудачи» и немного подкручивает свою гипотезу о ветре:

    $$ \hat{w}_{\text{новая}} = \hat{w}_{\text{старая}} + \gamma \cdot s $$
    
    или, если расписать $s$:
    
    $$ \hat{w}_{\text{новая}} = \hat{w}_{\text{старая}} + \gamma \cdot (v + x) $$

    Здесь $\gamma$ (гамма) — это уже не скорость, а маленький коэффициент, который можно назвать «шагом обучения» или «уровнем доверчивости» дрона к показаниям своего детектора.

    **Что это значит на человеческом?**
    Если «детектор неудачи» $s$ кричит, что дрона уносит вправо (и позиция $x$, и скорость $v$ положительны), формула говорит: «Эй, твоя догадка о ветре, дующем вправо, была слишком оптимистичной! Думай сильнее!». Дрон тут же увеличивает свою оценку $\hat{w}$. В следующий миг его упреждающий пинок $-\hat{w}$ становится мощнее, и он эффективнее борется с Ветром.
    Этот процесс самокопания и обучения продолжается, пока гипотеза $\hat{w}$ не станет почти точной копией реального ветра $w$. В этот момент «детектор неудачи» замолкает, оценка перестает меняться. Дрон гордо висит в точке ноль, а Ветер в бессильной ярости обдувает его, не в силах сдвинуть. Более того, после короткого периода обучения дрон имеет достаточно точное представление о силе ветра и компенсирует его с самурайской точностью и скоростью. Занавес. 